<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividad 1.5: Shell</title>
    <link rel="icon" type="image/png" href="../IMAGENES/logoescom.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --accent: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #1a2a3a;
            --gray: #95a5a6;
            --monster-color: #3498db; /* Azul para el Shell */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #0a0f3d, #1a2a3a, #2c3e50);
            color: var(--light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background:
                radial-gradient(circle at 20% 20%, rgba(46, 204, 113, 0.10) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(52, 152, 219, 0.10) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(231, 76, 60, 0.05) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 12s ease-in-out infinite;
        }

        @keyframes backgroundShift { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        @keyframes victoryGlow { 0%,100%{filter:brightness(1)} 50%{filter:brightness(1.05) hue-rotate(8deg)} }
        @keyframes defeatPulse { 0%,100%{filter:brightness(1)} 50%{filter:brightness(.95) contrast(1.05)} }

        .floating-home-btn{
            position:fixed; top:20px; right:20px; background:var(--secondary); color:#fff;
            width:60px; height:60px; border-radius:50%; display:flex; align-items:center; justify-content:center;
            text-decoration:none; box-shadow:0 4px 20px rgba(52,152,219,.3); transition:.3s; z-index:1000; font-size:1.5rem;
            opacity:1; visibility:visible;
        }
        .floating-home-btn:hover{ background:#2980b9; transform:translateY(-3px); box-shadow:0 6px 25px rgba(52,152,219,.4) }
        .floating-home-btn.hidden{opacity:0; visibility:hidden}

        .sidebar-nav{
            position:fixed; left:0; top:0; width:280px; height:100vh; background:rgba(0,0,0,.9); backdrop-filter:blur(10px);
            border-right:1px solid rgba(255,255,255,.1); z-index:999; transition:transform .3s ease; transform:translateX(-100%); overflow-y:auto;
        }
        .sidebar-nav.active{ transform:translateX(0) }
        .sidebar-header{ padding:20px; background:rgba(52,152,219,.1); border-bottom:1px solid rgba(52,152,219,.3) }
        .sidebar-title{ font-size:1.2rem; color:var(--secondary); font-weight:600; margin-bottom:5px }
        .sidebar-subtitle{ font-size:.9rem; color:var(--gray) }
        .nav-sections{ padding:20px 0 }
        .nav-section{ margin-bottom:15px }
        .nav-section-title{ padding:10px 20px; font-size:1rem; font-weight:600; color:var(--secondary); border-bottom:1px solid rgba(52,152,219,.2); margin-bottom:10px }
        .nav-item{ display:block; padding:12px 20px; color:var(--light); text-decoration:none; transition:.3s; border-left:3px solid transparent }
        .nav-item:hover{ background:rgba(52,152,219,.1); border-left-color:var(--secondary); padding-left:25px }
        .nav-item i{ margin-right:10px; width:20px; text-align:center }

        .menu-toggle{
            position:fixed; top:20px; left:20px; background:var(--primary); color:#fff; width:50px; height:50px; border-radius:8px; border:none; cursor:pointer;
            display:flex; align-items:center; justify-content:center; box-shadow:0 4px 15px rgba(0,0,0,.3); transition:.3s; z-index:1001; font-size:1.2rem;
        }
        .menu-toggle:hover{ background:var(--secondary); transform:translateY(-2px) }
        .menu-toggle.active{ background:var(--accent) }

        .reading-progress{ position:fixed; top:0; left:0; width:100%; height:4px; background:rgba(255,255,255,.1); z-index:998 }
        .reading-progress-bar{ height:100%; background:linear-gradient(90deg,var(--secondary),var(--success)); width:0%; transition:width .1s ease }

        .sidebar-overlay{
            position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.5); z-index:998; opacity:0; visibility:hidden; transition:.3s;
        }
        .sidebar-overlay.active{ opacity:1; visibility:visible }

        .container{ max-width:1200px; margin:0 90px; padding:20px; transition: margin-left .3s ease, margin-right .3s ease; }
        .header{ text-align:center; padding:30px 20px; background:rgba(0,0,0,.3); border-radius:15px; margin-bottom:30px }
        .breadcrumb{ display:flex; justify-content:center; margin-bottom:20px; color:var(--gray); font-size:1rem }
        .breadcrumb a{ color:var(--secondary); text-decoration:none; transition:.3s }
        .breadcrumb a:hover{ color:#fff; text-decoration:underline }
        .breadcrumb span{ margin:0 10px }
        h1{ font-size:2.5rem; margin-bottom:15px; color:#fff }
        .subtitle{ font-size:1.2rem; color:var(--secondary); margin-bottom:20px }

        .instructions{
            background:rgba(52,152,219,.15); border:1px solid rgba(52,152,219,.3); border-radius:10px; padding:20px; margin-bottom:30px; border-left:4px solid var(--secondary);
        }
        .instructions h3{ color:var(--secondary); margin-bottom:15px; font-size:1.3rem }
        .instructions ul{ padding-left:25px; color:var(--light) }
        .instructions li{ margin-bottom:8px }

        .battle-arena{
            background:rgba(255,255,255,.05); border-radius:15px; padding:30px; margin-bottom:30px; box-shadow:0 5px 15px rgba(0,0,0,.2);
            border:1px solid rgba(46,204,113,.25); position:relative; overflow:hidden;
        }
        .battle-arena::before{
            content:""; position:absolute; top:0; left:0; width:100%; height:100%;
            background: radial-gradient(circle at 50% 50%, rgba(46,204,113,.06) 0%, transparent 70%);
            z-index:-1; animation:arenaGlow 4s ease-in-out infinite;
        }
        @keyframes arenaGlow{ 0%,100%{opacity:.3} 50%{opacity:.8} }

        .monster-section{
            text-align:center; margin-bottom:30px; padding:25px; background:rgba(46,204,113,.14); border-radius:15px; border:2px solid rgba(46,204,113,.45);
            position:relative; overflow:hidden;
        }
        .monster-section::before{
            content:""; position:absolute; top:-50%; left:-50%; width:200%; height:200%;
            background: radial-gradient(circle, rgba(46,204,113,.12) 0%, transparent 70%);
            animation:monsterAura 3s linear infinite; z-index:-1;
        }
        @keyframes monsterAura{ 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }

        .monster-avatar{ font-size:5rem; margin-bottom:15px; animation:float 3s ease-in-out infinite }
        @keyframes float{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
        .monster-name{ font-size:1.8rem; color:var(--monster-color); font-weight:bold; margin-bottom:10px }

        .health-bar-container{
            width:300px; height:20px; background:rgba(0,0,0,.3); border-radius:10px; margin:0 auto 15px; overflow:hidden; border:2px solid rgba(46,204,113,.5);
        }
        .health-bar{ height:100%; background:linear-gradient(90deg,var(--accent),var(--warning)); transition:width .5s ease; border-radius:8px }
        .health-text{ font-size:1.2rem; font-weight:bold; color:var(--light) }

        .player-stats{ display:flex; justify-content:center; gap:30px; margin-bottom:20px; flex-wrap:wrap }
        .stat-card{ background:rgba(255,255,255,.1); padding:15px 20px; border-radius:10px; text-align:center; border:1px solid rgba(255,255,255,.2) }
        .stat-value{ font-size:1.5rem; font-weight:bold; color:var(--secondary) }
        .stat-label{ font-size:.9rem; color:var(--gray) }

        .error-indicators{ display:flex; justify-content:center; gap:10px; margin-top:10px }
        .error-dot{ width:15px; height:15px; border-radius:50%; background:rgba(255,255,255,.2); transition:.3s }
        .error-dot.filled{ background:var(--accent); box-shadow:0 0 10px rgba(231,76,60,.5) }

        .questions-section{ margin-top:30px }
        .questions-section h3{
            color:var(--warning); margin-bottom:20px; font-size:1.3rem; text-align:center; border-bottom:2px solid var(--warning); padding-bottom:10px
        }
        .question{
            background:rgba(255,255,255,.08); border-radius:10px; padding:25px; margin-bottom:25px; border-left:4px solid var(--warning); transition:.3s
        }
        .question:hover{ background:rgba(255,255,255,.12); transform:translateX(5px) }
        .question-number{ font-size:1.2rem; font-weight:bold; color:var(--warning); margin-bottom:15px }
        .question-text{ font-size:1.1rem; margin-bottom:20px; line-height:1.5 }

        .options{ display:grid; gap:12px }
        .option{
            background:rgba(255,255,255,.05); border:2px solid rgba(255,255,255,.1); border-radius:8px; padding:15px; cursor:pointer; transition:.3s;
            display:flex; align-items:flex-start; gap:12px
        }
        .option:hover{ background:rgba(255,255,255,.1); border-color:var(--secondary); transform:translateX(3px) }
        .option.selected{ background:rgba(52,152,219,.2); border-color:var(--secondary); box-shadow:0 0 15px rgba(52,152,219,.3) }
        .option.correct{ background:rgba(46,204,113,.2); border-color:var(--success); box-shadow:0 0 15px rgba(46,204,113,.4); animation:correctPulse .6s ease }
        .option.incorrect{ background:rgba(231,76,60,.2); border-color:var(--accent); box-shadow:0 0 15px rgba(231,76,60,.4); animation:incorrectShake .6s ease }
        @keyframes correctPulse{ 0%{transform:scale(1)} 50%{transform:scale(1.02)} 100%{transform:scale(1)} }
        @keyframes incorrectShake{ 0%,100%{transform:translateX(0)} 25%{transform:translateX(-3px)} 75%{transform:translateX(3px)} }
        .option-letter{ font-weight:bold; font-size:1.1rem; color:var(--secondary); min-width:25px }
        .option.correct .option-letter{ color:var(--success) }
        .option.incorrect .option-letter{ color:var(--accent) }
        .option-text{ flex:1; font-size:1rem }

        .battle-controls{
            display:flex; flex-wrap:wrap; gap:20px; align-items:center; justify-content:center; padding:20px; background:rgba(0,0,0,.2);
            border-radius:10px; margin:30px 0
        }
        .btn{ padding:15px 30px; border:none; border-radius:30px; font-weight:600; cursor:pointer; transition:.3s; text-decoration:none;
              display:inline-flex; align-items:center; gap:8px; font-size:1.1rem }
        .btn-attack{ background:var(--accent); color:#fff; box-shadow:0 4px 15px rgba(231,76,60,.3); font-size:1.2rem; padding:18px 35px }
        .btn-attack:hover{ background:#c0392b; transform:translateY(-3px); box-shadow:0 6px 20px rgba(231,76,60,.4) }
        .btn-attack:disabled{ background:var(--gray); cursor:not-allowed; transform:none; box-shadow:none }
        .btn-secondary{ background:var(--gray); color:#fff; box-shadow:0 4px 15px rgba(149,165,166,.3) }
        .btn-secondary:hover{ background:#7f8c8d; transform:translateY(-3px) }
        .btn-success{ background:var(--success); color:#fff; box-shadow:0 4px 15px rgba(46,204,113,.3) }
        .btn-success:hover{ background:#27ae60; transform:translateY(-3px) }

        .game-status{ text-align:center; padding:20px; border-radius:10px; margin:20px 0; font-size:1.2rem; font-weight:bold; display:none }
        .game-status.victory{ background:rgba(46,204,113,.2); border:2px solid var(--success); color:var(--success) }
        .game-status.defeat{ background:rgba(231,76,60,.2); border:2px solid var(--accent); color:var(--accent) }
        .game-status.continue{ background:rgba(243,156,18,.2); border:2px solid var(--warning); color:var(--warning) }

        .navigation{ display:flex; justify-content:space-between; align-items:center; margin-top:30px; gap:15px }
        .nav-center{ display:flex; justify-content:center; flex:1 }

        .progress-bar{ width:100%; height:8px; background:rgba(255,255,255,.1); border-radius:4px; margin:20px 0; overflow:hidden }
        .progress-fill{ height:100%; background:linear-gradient(90deg,var(--secondary),var(--success)); transition:width .3s ease; width:0% }

        .scroll-to-top{
            position:fixed; bottom:20px; right:20px; background:var(--accent); color:#fff; width:50px; height:50px; border-radius:50%; border:none; cursor:pointer;
            display:flex; align-items:center; justify-content:center; box-shadow:0 4px 15px rgba(231,76,60,.3); transition:.3s; opacity:0; visibility:hidden; z-index:999
        }
        .scroll-to-top.visible{ opacity:1; visibility:visible }
        .scroll-to-top:hover{ background:#c0392b; transform:translateY(-3px) }

        @media (max-width:768px){
            .sidebar-nav{ width:100% }
            h1{ font-size:2rem }
            .battle-controls{ flex-direction:column; gap:15px }
            .player-stats{ flex-direction:column; gap:15px }
            .navigation{ flex-direction:column; gap:15px }
            .nav-center{ order:2 }
            .navigation .btn{ width:100%; text-align:center; justify-content:center }
            .question{ padding:20px }
            .floating-home-btn{ width:50px; height:50px; font-size:1.2rem }
            .container { margin:0 20px; padding:10px; }
            .health-bar-container{ width:250px }
            .monster-avatar{ font-size:4rem }
        }
    </style>
</head>
<body>
    <div class="reading-progress"><div class="reading-progress-bar" id="readingProgressBar"></div></div>

    <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>

    <a href="index.html" class="floating-home-btn" title="Ir al inicio"><i class="fas fa-home"></i></a>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <nav class="sidebar-nav" id="sidebarNav">
        <div class="sidebar-header">
            <div class="sidebar-title">Shell y Scripts</div>
            <div class="sidebar-subtitle">Interfaz de Comando</div>
        </div>
        <div class="nav-sections">
            <div class="nav-section">
                <div class="nav-section-title">Navegaci√≥n</div>
                <a href="index.html" class="nav-item"><i class="fas fa-home"></i> Men√∫ principal</a>
                <a href="1.5.html" class="nav-item"><i class="fas fa-book-open"></i> Volver al material</a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Otras Actividades</div>
                <a href="actividad_1_1.html" class="nav-item"><i class="fas fa-tasks"></i> Actividad 1.1</a>
                <a href="actividad_1_2.html" class="nav-item"><i class="fas fa-tasks"></i> Actividad 1.2</a>
                <a href="actividad_1_3.html" class="nav-item"><i class="fas fa-tasks"></i> Actividad 1.3</a>
                <a href="actividad_1_4.html" class="nav-item"><i class="fas fa-tasks"></i> Actividad 1.4</a>
            </div>
        </div>
    </nav>

    <button class="scroll-to-top" id="scrollToTop"><i class="fas fa-chevron-up"></i></button>

    <div class="container">
        <div class="header">
            <div class="breadcrumb">
                <a href="index.html"><i class="fas fa-home"></i> Inicio</a>
                <span>/</span>
                <a href="1.5.html">1.5 Shell</a>
                <span>/</span>
                <span>Batalla de Shell</span>
            </div>
            <h1>‚å®Ô∏è Batalla de Shell</h1>
            <div class="subtitle">¬°Derrota al Guardi√°n del Shell acertando las preguntas!</div>
        </div>

        <div class="instructions">
            <h3><i class="fas fa-gamepad"></i> Instrucciones de Batalla</h3>
            <ul>
                <li><strong>Misi√≥n:</strong> Responde correctamente preguntas sobre <em>Shell, comandos y scripting</em>.</li>
                <li><strong>Mec√°nica:</strong> Cada respuesta correcta hace 1 punto de da√±o. Cada incorrecta suma un error.</li>
                <li><strong>Victoria:</strong> Reduce la vida del guardi√°n a 0 HP contestando correctamente las preguntas.</li>
                <li><strong>Derrota:</strong> Llegas a 3 errores antes de derrotarlo.</li>
                <li><strong>Estrategia:</strong> Analiza bien si es un comando, una variable o una estructura de control.</li>
            </ul>
        </div>

        <div class="battle-arena">
            <div class="monster-section">
                <div class="monster-avatar" id="monsterAvatar">üíª</div>
                <div class="monster-name">Guardi√°n del Shell</div>
                <div class="health-bar-container">
                    <div class="health-bar" id="healthBar" style="width: 100%;"></div>
                </div>
                <div class="health-text" id="healthText">8 / 8 HP</div>
            </div>

            <div class="player-stats">
                <div class="stat-card">
                    <div class="stat-value" id="timerValue">0s</div>
                    <div class="stat-label"><i class="fas fa-clock"></i> Tiempo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="attemptsValue">0</div>
                    <div class="stat-label"><i class="fas fa-terminal"></i> Comandos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="errorsValue">0 / 3</div>
                    <div class="stat-label"><i class="fas fa-skull"></i> Errores</div>
                    <div class="error-indicators" id="errorIndicators">
                        <div class="error-dot"></div>
                        <div class="error-dot"></div>
                        <div class="error-dot"></div>
                    </div>
                </div>
            </div>

            <div class="questions-section">
                <h3><i class="fas fa-scroll"></i> Desaf√≠os de Comandos</h3>
                <div id="questionsContainer"></div>
            </div>

            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>

            <div class="battle-controls">
                <button class="btn btn-attack" onclick="attack()" id="attackBtn">
                    <i class="fas fa-bolt"></i> ¬°EJECUTAR!
                </button>
                <button class="btn btn-secondary" onclick="resetBattle()">
                    <i class="fas fa-redo"></i> Nueva Batalla
                </button>
                <button class="btn btn-secondary" onclick="showSolutions()">
                    <i class="fas fa-lightbulb"></i> Ver Respuestas
                </button>
            </div>

            <div class="game-status" id="gameStatus"></div>
        </div>

        <div class="navigation">
            <a href="1.5.html" class="btn btn-success">
                <i class="fas fa-arrow-left"></i> Volver al Material
            </a>
            <div class="nav-center">
                <a href="index.html" class="btn btn-secondary">
                    <i class="fas fa-home"></i> Men√∫ Principal
                </a>
            </div>
            <a href="index.html" class="btn btn-success">
                Terminar Unidad <i class="fas fa-flag-checkered"></i>
            </a>
        </div>
    </div>

    <script>
  // ========================
  // VARIABLES DEL JUEGO
  // ========================
  let time = 0;
  let attempts = 0;
  let errors = 0;
  let monsterHP = 8;
  const maxHP = 8;
  const maxErrors = 3;
  let gameOver = false;
  let timerInterval;
  let sidebarOpen = false;
  let selectedAnswers = {};
  let completed = 0;
  let questions = []; // Se cargar√°n desde archivo externo JSON

  // ========================
  // FUNCI√ìN PARA INICIAR EL JUEGO (JSON ES/EN)
  // ========================
  async function initGame() {
    const container = document.getElementById('questionsContainer');

    try {
      // Cargar preguntas desde archivo JSON externo (Actividad 1.5)
      const response = await fetch('preguntas_1.5.json');
      if (!response.ok) {
        throw new Error(`No se pudo cargar preguntas_1.5.json (HTTP ${response.status})`);
      }
      const allQuestionsRaw = await response.json();

      // Validaci√≥n b√°sica
      if (!Array.isArray(allQuestionsRaw) || allQuestionsRaw.length === 0) {
        throw new Error('El JSON no contiene un arreglo de preguntas.');
      }

      // Mezclar y seleccionar 8 preguntas aleatorias
      shuffleArray(allQuestionsRaw);
      questions = allQuestionsRaw.slice(0, 8).map((q, idx) => {
        // Adaptar claves en espa√±ol/ingl√©s
        const questionText = q.pregunta ?? q.question ?? q.text;
        const optionsOrig = q.opciones ?? q.options;
        const answerOrig  = q.respuesta_correcta ?? q.answer;

        if (!questionText || !Array.isArray(optionsOrig) || !answerOrig) {
          throw new Error(`Pregunta ${idx + 1} con formato inv√°lido (faltan campos).`);
        }

        // Barajar opciones y ubicar √≠ndice correcto
        const optionsShuffled = shuffleArray([...optionsOrig]);
        const norm = s => String(s).trim();
        let correctIndex = optionsShuffled.findIndex(o => norm(o) === norm(answerOrig));

        if (correctIndex === -1) {
          throw new Error(
            `La respuesta no coincide con ninguna opci√≥n en: "${questionText.substring(0, 60)}..."`
          );
        }

        return {
          question: questionText,
          options: optionsShuffled,
          correct: correctIndex
        };
      });

      // Limpiar el contenedor y renderizar preguntas
      container.innerHTML = '';
      questions.forEach((q, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question';
        questionDiv.innerHTML = `
          <div class="question-number">Desaf√≠o ${index + 1}</div>
          <div class="question-text">${q.question}</div>
          <div class="options">
            ${q.options.map((option, optIndex) => `
              <div class="option" onclick="selectOption(${index}, ${optIndex})" id="q${index}opt${optIndex}">
                <div class="option-letter">${String.fromCharCode(97 + optIndex)})</div>
                <div class="option-text">${option}</div>
              </div>
            `).join('')}
          </div>
        `;
        container.appendChild(questionDiv);
      });

      // Reiniciar estado y arrancar temporizador
      time = attempts = errors = completed = 0;
      monsterHP = maxHP;
      selectedAnswers = {};
      updateUI();
      clearInterval(timerInterval);
      startTimer();

    } catch (err) {
      console.error(err);
      container.innerHTML = `
        <div class="question">
          ‚ö†Ô∏è <strong>Error al cargar preguntas:</strong><br>${err.message}
        </div>`;
    }
  }

  // ========================
  // UTIL: MEZCLAR ARRAY (Fisher-Yates)
  // ========================
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // ========================
  // FUNCIONES DE JUEGO
  // ========================
  function startTimer() {
    timerInterval = setInterval(() => {
      time++;
      document.getElementById('timerValue').textContent = `${time}s`;
    }, 1000);
  }

  function updateProgress() {
    completed = Object.keys(selectedAnswers).length;
    const percentage = (completed / questions.length) * 100;
    document.getElementById('progressFill').style.width = `${percentage}%`;
  }

  function updateMonsterAvatar() {
    const avatar = document.getElementById('monsterAvatar');
    const healthPercentage = (monsterHP / maxHP) * 100;
    // Iconos tem√°ticos de Shell/Terminal
    if (healthPercentage > 70) avatar.textContent = 'üíª';
    else if (healthPercentage > 40) avatar.textContent = '‚å®Ô∏è';
    else if (healthPercentage > 0) avatar.textContent = 'üîå';
    else avatar.textContent = 'üí•';
  }

  function updateUI() {
    document.getElementById('healthBar').style.width = `${(monsterHP / maxHP) * 100}%`;
    document.getElementById('healthText').textContent = `${monsterHP} / ${maxHP} HP`;
    const dots = document.querySelectorAll('.error-dot');
    dots.forEach((dot, i) => {
      dot.classList.toggle('filled', i < errors);
    });
    document.getElementById('attemptsValue').textContent = attempts;
    document.getElementById('errorsValue').textContent = `${errors} / ${maxErrors}`;
    updateMonsterAvatar();
  }

  function selectOption(qIndex, oIndex) {
    for (let i = 0; i < questions[qIndex].options.length; i++) {
      document.getElementById(`q${qIndex}opt${i}`).classList.remove('selected');
    }
    document.getElementById(`q${qIndex}opt${oIndex}`).classList.add('selected');
    selectedAnswers[qIndex] = oIndex;
    updateProgress();
  }

  function attack() {
    if (gameOver) return;
    if (completed < questions.length) {
      return showGameStatus("‚ö†Ô∏è ¬°Responde todas las preguntas antes de ejecutar!", "continue");
    }
    attempts++;
    let correct = 0;

    questions.forEach((q, i) => {
      const userAns = selectedAnswers[i];
      const correctAns = q.correct;

      for (let j = 0; j < q.options.length; j++) {
        const optEl = document.getElementById(`q${i}opt${j}`);
        optEl.classList.remove('selected', 'correct', 'incorrect');
        if (j === correctAns) optEl.classList.add('correct');
        else if (j === userAns) optEl.classList.add('incorrect');
      }
      if (userAns === correctAns) correct++;
    });

    monsterHP = Math.max(0, monsterHP - correct);
    errors = Math.min(maxErrors, questions.length - correct);
    updateUI();
    checkGameEnd();
  }

  function checkGameEnd() {
    const btn = document.getElementById('attackBtn');
    if (monsterHP <= 0) {
      gameOver = true;
      clearInterval(timerInterval);
      showGameStatus(`<i class='fas fa-trophy'></i> ¬°VICTORIA! Tiempo: ${time}s`, 'victory');
      btn.disabled = true;
      document.body.style.animation = 'victoryGlow 2s infinite';
    } else if (errors >= maxErrors) {
      gameOver = true;
      clearInterval(timerInterval);
      showGameStatus(`<i class='fas fa-skull'></i> ¬°DERROTA! Demasiados errores`, 'defeat');
      btn.disabled = true;
      document.body.style.animation = 'defeatPulse 1s infinite';
    }
  }

  function resetBattle() {
    time = attempts = errors = completed = 0;
    monsterHP = maxHP;
    gameOver = false;
    selectedAnswers = {};
    document.getElementById('timerValue').textContent = '0s';
    document.getElementById('attemptsValue').textContent = '0';
    document.getElementById('errorsValue').textContent = '0 / 3';
    document.getElementById('gameStatus').style.display = 'none';
    document.getElementById('attackBtn').disabled = false;
    document.getElementById('progressFill').style.width = '0%';
    document.body.style.animation = 'none';
    questions.forEach((q, i) => {
      q.options.forEach((_, j) => {
        const el = document.getElementById(`q${i}opt${j}`);
        if (el) el.classList.remove('selected', 'correct', 'incorrect');
      });
    });
    updateUI();
    clearInterval(timerInterval);
    startTimer();
  }

  function showGameStatus(msg, type) {
    const div = document.getElementById('gameStatus');
    div.innerHTML = msg;
    div.className = `game-status ${type}`;
    div.style.display = 'block';
    if (type === 'continue') setTimeout(() => div.style.display = 'none', 4000);
  }

  function showSolutions() {
    const answers = questions.map((q, i) => `${i + 1}. ${q.options[q.correct]}`).join('\n');
    alert(`üí° Respuestas Correctas:\n\n${answers}`);
  }

  // ====== Utilidades de layout ======
  function updateContainerSpacing() {
    const container = document.querySelector('.container');
    if (window.innerWidth <= 768) {
      container.style.margin = '0 20px';
    } else {
      container.style.margin = sidebarOpen ? '0 90px 0 370px' : '0 90px';
    }
  }
  function updateReadingProgress() {
    const scroll = document.documentElement.scrollTop;
    const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const percent = Math.min((scroll / height) * 100, 100);
    document.getElementById('readingProgressBar').style.width = `${percent}%`;
  }

  // Sidebar & botones flotantes
  const menuToggle = document.getElementById('menuToggle');
  const sidebarNav = document.getElementById('sidebarNav');
  const sidebarOverlay = document.getElementById('sidebarOverlay');
  const scrollToTopBtn = document.getElementById('scrollToTop');
  const floatingHomeBtn = document.querySelector('.floating-home-btn');

  function toggleSidebar() {
    sidebarOpen = !sidebarOpen;
    if (sidebarOpen) {
      sidebarNav.classList.add('active');
      sidebarOverlay.classList.add('active');
      menuToggle.classList.add('active');
      menuToggle.innerHTML = '<i class="fas fa-times"></i>';
      document.body.style.overflow = 'hidden';
    } else {
      sidebarNav.classList.remove('active');
      sidebarOverlay.classList.remove('active');
      menuToggle.classList.remove('active');
      menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
      document.body.style.overflow = 'auto';
    }
    updateContainerSpacing();
  }
  menuToggle.addEventListener('click', toggleSidebar);
  sidebarOverlay.addEventListener('click', toggleSidebar);

  function toggleFloatingButtons() {
    const y = window.pageYOffset, h = window.innerHeight, dh = document.documentElement.scrollHeight;
    if (y > 300) scrollToTopBtn.classList.add('visible'); else scrollToTopBtn.classList.remove('visible');
    const nearBottom = y + h >= dh - 100;
    if (nearBottom) floatingHomeBtn.classList.add('hidden'); else floatingHomeBtn.classList.remove('hidden');
  }
  scrollToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

  // Iniciar juego al cargar la p√°gina
  document.addEventListener('DOMContentLoaded', () => {
    initGame();
    updateContainerSpacing();
    updateReadingProgress();
  });
  window.addEventListener('scroll', () => { updateReadingProgress(); toggleFloatingButtons(); });
  window.addEventListener('resize', () => { updateContainerSpacing(); });
</script>

</body>
</html>