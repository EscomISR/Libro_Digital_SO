<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividad 1.2: Fundamentos del N√∫cleo del Sistema Operativo</title>
    <link rel="icon" type="image/png" href="logoescom.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --accent: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #1a2a3a;
            --gray: #95a5a6;
            --monster-color: #1abc9c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #0a1a0f, #1a2a3a, #2c3e50);
            color: var(--light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(26, 188, 156, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(15, 76, 58, 0.1) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 12s ease-in-out infinite;
        }

        @keyframes backgroundShift { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }

        /* Bot√≥n flotante de inicio */
        .floating-home-btn {
            position: fixed; top: 20px; right: 20px; background: var(--secondary); color: white;
            width: 60px; height: 60px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; text-decoration: none;
            box-shadow: 0 4px 20px rgba(52, 152, 219, 0.3);
            transition: all 0.3s ease; z-index: 1000; font-size: 1.5rem; opacity: 1; visibility: visible;
        }
        .floating-home-btn:hover { background: #2980b9; transform: translateY(-3px); box-shadow: 0 6px 25px rgba(52, 152, 219, 0.4); }
        .floating-home-btn.hidden { opacity: 0; visibility: hidden; }

        /* Men√∫ lateral */
        .sidebar-nav {
            position: fixed; left: 0; top: 0; width: 280px; height: 100vh;
            background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1); z-index: 999;
            transition: transform 0.3s ease; transform: translateX(-100%); overflow-y: auto;
        }
        .sidebar-nav.active { transform: translateX(0); }
        .sidebar-header { padding: 20px; background: rgba(52, 152, 219, 0.1); border-bottom: 1px solid rgba(52, 152, 219, 0.3); }
        .sidebar-title { font-size: 1.2rem; color: var(--secondary); font-weight: 600; margin-bottom: 5px; }
        .sidebar-subtitle { font-size: 0.9rem; color: var(--gray); }
        .nav-sections { padding: 20px 0; }
        .nav-section { margin-bottom: 15px; }
        .nav-section-title { padding: 10px 20px; font-size: 1rem; font-weight: 600; color: var(--secondary); border-bottom: 1px solid rgba(52, 152, 219, 0.2); margin-bottom: 10px; }
        .nav-item { display: block; padding: 12px 20px; color: var(--light); text-decoration: none; transition: all 0.3s ease; border-left: 3px solid transparent; }
        .nav-item:hover { background: rgba(52, 152, 219, 0.1); border-left-color: var(--secondary); padding-left: 25px; }
        .nav-item i { margin-right: 10px; width: 20px; text-align: center; }

        /* Bot√≥n toggle del men√∫ */
        .menu-toggle {
            position: fixed; top: 20px; left: 20px; background: var(--primary); color: white;
            width: 50px; height: 50px; border-radius: 8px; border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease; z-index: 1001; font-size: 1.2rem;
        }
        .menu-toggle:hover { background: var(--secondary); transform: translateY(-2px); }
        .menu-toggle.active { background: var(--accent); }

        /* Progreso lectura */
        .reading-progress { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: rgba(255, 255, 255, 0.1); z-index: 998; }
        .reading-progress-bar { height: 100%; background: linear-gradient(90deg, var(--secondary), var(--success)); width: 0%; transition: width 0.1s ease; }

        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); z-index: 998; opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        .sidebar-overlay.active { opacity: 1; visibility: visible; }

        /* Contenedor principal */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; transition: margin-left 0.3s ease, margin-right 0.3s ease; }
        .header { text-align: center; padding: 30px 20px; background: rgba(0, 0, 0, 0.3); border-radius: 15px; margin-bottom: 30px; }
        .breadcrumb { display: flex; justify-content: center; margin-bottom: 20px; color: var(--gray); font-size: 1rem; }
        .breadcrumb a { color: var(--secondary); text-decoration: none; transition: color 0.3s; }
        .breadcrumb a:hover { color: white; text-decoration: underline; }
        .breadcrumb span { margin: 0 10px; }
        h1 { font-size: 2.5rem; margin-bottom: 15px; color: white; }
        .subtitle { font-size: 1.2rem; color: var(--secondary); margin-bottom: 20px; }

        .instructions {
            background: rgba(52, 152, 219, 0.15);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 10px; padding: 20px; margin-bottom: 30px; border-left: 4px solid var(--secondary);
        }
        .instructions h3 { color: var(--secondary); margin-bottom: 15px; font-size: 1.3rem; }
        .instructions ul { padding-left: 25px; color: var(--light); }
        .instructions li { margin-bottom: 8px; }

        /* Arena */
        .battle-arena {
            background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 30px; margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); border: 1px solid rgba(26, 188, 156, 0.3);
            position: relative; overflow: hidden;
        }

        .monster-section {
            text-align: center; margin-bottom: 30px; padding: 25px;
            background: rgba(26, 188, 156, 0.15); border-radius: 15px; border: 2px solid rgba(26, 188, 156, 0.4);
        }
        .monster-avatar { font-size: 5rem; margin-bottom: 15px; }
        .monster-name { font-size: 1.8rem; color: var(--monster-color); font-weight: bold; margin-bottom: 10px; }

        .health-bar-container { width: 300px; height: 20px; background: rgba(0, 0, 0, 0.3); border-radius: 10px; margin: 0 auto 15px; overflow: hidden; border: 2px solid rgba(26, 188, 156, 0.5); }
        .health-bar { height: 100%; background: linear-gradient(90deg, var(--accent), var(--warning)); transition: width 0.5s ease; border-radius: 8px; }
        .health-text { font-size: 1.2rem; font-weight: bold; color: var(--light); }

        .player-stats { display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-card { background: rgba(255, 255, 255, 0.1); padding: 15px 20px; border-radius: 10px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); }
        .stat-value { font-size: 1.5rem; font-weight: bold; color: var(--secondary); }
        .stat-label { font-size: 0.9rem; color: var(--gray); }

        .error-indicators { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        .error-dot { width: 15px; height: 15px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); transition: all 0.3s ease; }
        .error-dot.filled { background: var(--accent); box-shadow: 0 0 10px rgba(231, 76, 60, 0.5); }

        /* Controles */
        .battle-controls {
            display: flex; flex-wrap: wrap; gap: 20px; align-items: center; justify-content: center;
            padding: 20px; background: rgba(0, 0, 0, 0.2); border-radius: 10px; margin: 30px 0;
        }
        .btn { padding: 15px 30px; border: none; border-radius: 30px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; font-size: 1.1rem; }
        .btn-attack { background: var(--accent); color: white; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3); font-size: 1.2rem; padding: 18px 35px; }
        .btn-attack:hover { background: #c0392b; transform: translateY(-3px); box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4); }
        .btn-secondary { background: var(--gray); color: white; }
        .btn-secondary:hover { background: #7f8c8d; transform: translateY(-3px); }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #27ae60; transform: translateY(-3px); }

        /* Estado */
        .game-status { text-align: center; padding: 20px; border-radius: 10px; margin: 20px 0; font-size: 1.2rem; font-weight: bold; display: none; }
        .game-status.victory { background: rgba(46, 204, 113, 0.2); border: 2px solid var(--success); color: var(--success); }
        .game-status.defeat { background: rgba(231, 76, 60, 0.2); border: 2px solid var(--accent); color: var(--accent); }
        .game-status.continue { background: rgba(243, 156, 18, 0.2); border: 2px solid var(--warning); color: var(--warning); }

        /* Navegaci√≥n inferior */
        .navigation { display: flex; justify-content: space-between; align-items: center; margin-top: 30px; gap: 15px; }
        .nav-center { display: flex; justify-content: center; flex: 1; }

        /* Preguntas */
        .questions-section h3 { color: var(--warning); margin-bottom: 20px; font-size: 1.3rem; text-align: center; border-bottom: 2px solid var(--warning); padding-bottom: 10px; }
        .question { background: rgba(255,255,255,0.08); padding: 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.18); margin-bottom: 14px; }
        .question-number { font-weight: 700; color: var(--warning); margin-bottom: 6px; }
        .question-text { font-size: 1rem; margin-bottom: 12px; }
        .options { display: grid; gap: 8px; }
        .option { display:flex; gap:10px; align-items:center; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.15); background:rgba(0,0,0,.2); cursor:pointer; transition:all .2s ease; }
        .option:hover{ background: rgba(255,255,255,.10); }
        .option-letter{ font-weight:700; color:var(--secondary); }
        .option.selected{ outline:2px solid var(--secondary); }
        .option.correct{ outline:2px solid var(--success); background:rgba(46,204,113,.12); }
        .option.incorrect{ outline:2px solid var(--accent); background:rgba(231,76,60,.12); }

        /* Bot√≥n arriba */
        .scroll-to-top { position: fixed; bottom: 20px; right: 20px; background: var(--accent); color: white; width: 50px; height: 50px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; opacity: 0; visibility: hidden; z-index: 999; }
        .scroll-to-top.visible { opacity: 1; visibility: visible; }
        .scroll-to-top:hover { background: #c0392b; transform: translateY(-3px); }
    </style>
</head>
<body>
    <!-- Progreso -->
    <div class="reading-progress"><div class="reading-progress-bar" id="readingProgressBar"></div></div>

    <!-- Toggle men√∫ -->
    <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>

    <!-- Bot√≥n inicio -->
    <a href="index.html" class="floating-home-btn" title="Ir al inicio"><i class="fas fa-home"></i></a>

    <!-- Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Men√∫ lateral -->
    <nav class="sidebar-nav" id="sidebarNav">
        <div class="sidebar-header">
            <div class="sidebar-title">Fundamentos del N√∫cleo</div>
            <div class="sidebar-subtitle">Aspectos del Sistema Operativo</div>
        </div>
        <div class="nav-sections">
            <div class="nav-section">
                <div class="nav-section-title">Navegaci√≥n</div>
                <a href="index.html" class="nav-item"><i class="fas fa-home"></i> Men√∫ principal</a>
                <a href="1.2.html" class="nav-item"><i class="fas fa-book-open"></i> Volver al material</a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Otras Actividades</div>
                <a href="actividad_1_1.html" class="nav-item"><i class="fas fa-tasks"></i> Actividad 1.1</a>
                <a href="actividad_1_3.html" class="nav-item"><i class="fas fa-tasks"></i> Actividad 1.3</a>
                <a href="actividad_1_4.html" class="nav-item"><i class="fas fa-tasks"></i> Actividad 1.4</a>
                <a href="actividad_1_5.html" class="nav-item"><i class="fas fa-tasks"></i> Actividad 1.5</a>
            </div>
        </div>
    </nav>

    <!-- Bot√≥n arriba -->
    <button class="scroll-to-top" id="scrollToTop"><i class="fas fa-chevron-up"></i></button>

    <div class="container">
        <div class="header">
            <div class="breadcrumb">
                <a href="index.html"><i class="fas fa-home"></i> Inicio</a>
                <span>/</span>
                <a href="1.2.html">1.2 Fundamentos del N√∫cleo del Sistema Operativo</a>
                <span>/</span>
                <span>Batalla de Fundamentos</span>
            </div>
            <h1>üíª Batalla del N√∫cleo del Sistema Operativo</h1>
            <div class="subtitle">¬°Derrota al Maestro de los N√∫cleos con tus conocimientos!</div>
        </div>

        <div class="instructions">
            <h3><i class="fas fa-gamepad"></i> Instrucciones de Batalla</h3>
            <ul>
                <li><strong>Misi√≥n:</strong> Derrota al Maestro de los N√∫cleos respondiendo correctamente las preguntas sobre el n√∫cleo del SO.</li>
                <li><strong>Mec√°nica:</strong> Cada respuesta correcta inflige 1 punto de da√±o. Cada error suma un fallo.</li>
                <li><strong>Victoria:</strong> Reduce la vida del maestro a 0 HP respondiendo las 8 preguntas correctamente.</li>
                <li><strong>Derrota:</strong> Cometes m√°s de 3 errores antes de derrotarlo.</li>
                <li><strong>Estrategia:</strong> Lee cuidadosamente cada pregunta. ¬°Solo tienes una oportunidad por batalla!</li>
            </ul>
        </div>

        <div class="battle-arena">
            <!-- Enemigo -->
            <div class="monster-section">
                <div class="monster-avatar" id="monsterAvatar">üß†</div>
                <div class="monster-name">Maestro de los N√∫cleos</div>
                <div class="health-bar-container"><div class="health-bar" id="healthBar" style="width: 100%;"></div></div>
                <div class="health-text" id="healthText">8 / 8 HP</div>
            </div>

            <!-- Stats -->
            <div class="player-stats">
                <div class="stat-card">
                    <div class="stat-value" id="timerValue">0s</div>
                    <div class="stat-label"><i class="fas fa-clock"></i> Tiempo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="attemptsValue">0</div>
                    <div class="stat-label"><i class="fas fa-sword"></i> Ataques</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="errorsValue">0 / 3</div>
                    <div class="stat-label"><i class="fas fa-skull"></i> Errores</div>
                    <div class="error-indicators" id="errorIndicators">
                        <div class="error-dot"></div>
                        <div class="error-dot"></div>
                        <div class="error-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Preguntas -->
            <div class="questions-section">
                <h3><i class="fas fa-scroll"></i> Desaf√≠os del N√∫cleo</h3>
                <div id="questionsContainer"></div>
            </div>

            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>

            <!-- Controles -->
            <div class="battle-controls">
                <button class="btn btn-attack" onclick="attack()" id="attackBtn">
                    <i class="fas fa-bolt"></i> ¬°ATACAR!
                </button>
                <button class="btn btn-secondary" onclick="resetBattle()">
                    <i class="fas fa-redo"></i> Nueva Batalla
                </button>
                <button class="btn btn-secondary" onclick="showSolutions()">
                    <i class="fas fa-lightbulb"></i> Ver Respuestas
                </button>
            </div>

            <!-- Estado -->
            <div class="game-status" id="gameStatus"></div>
        </div>

        <div class="navigation">
            <a href="1.2.html" class="btn btn-success"><i class="fas fa-arrow-left"></i> Volver al Material</a>
            <div class="nav-center">
                <a href="index.html" class="btn btn-secondary"><i class="fas fa-home"></i> Men√∫ Principal</a>
            </div>
            <a href="1.3.html" class="btn btn-success">Siguiente Tema <i class="fas fa-arrow-right"></i></a>
        </div>
    </div>

    <script>
        let time = 0, attempts = 0, errors = 0, completed = 0;
        let monsterHP = 8, maxHP = 8, maxErrors = 3;
        let gameOver = false, timerInterval;
        let selectedAnswers = {};
        let questions = [];

        async function initGame() {
            const container = document.getElementById('questionsContainer');
            try {
                const res = await fetch('preguntas_1.2.json');
                if (!res.ok) throw new Error(`No se pudo cargar preguntas_1.2.json (HTTP ${res.status})`);
                const all = await res.json();
                if (!Array.isArray(all) || all.length === 0) throw new Error('El JSON no contiene preguntas.');

                shuffleArray(all);
                questions = all.slice(0, 8).map((item, idx) => {
                    const qText = item.pregunta ?? item.question;
                    const opts  = item.opciones ?? item.options;
                    const ans   = item.respuesta_correcta ?? item.answer;
                    if (!qText || !Array.isArray(opts) || !ans) throw new Error(`Pregunta ${idx+1} con formato inv√°lido.`);
                    const optionsShuffled = shuffleArray([...opts]);
                    const norm = s => String(s).trim();
                    const correctIndex = optionsShuffled.findIndex(o => norm(o) === norm(ans));
                    if (correctIndex === -1) throw new Error(`La respuesta no coincide en: "${qText}"`);
                    return { question: qText, options: optionsShuffled, correct: correctIndex };
                });

                container.innerHTML = '';
                questions.forEach((q, index) => {
                    const div = document.createElement('div');
                    div.className = 'question';
                    div.innerHTML = `
                        <div class="question-number">Desaf√≠o ${index + 1}</div>
                        <div class="question-text">${q.question}</div>
                        <div class="options">
                            ${q.options.map((option, optIndex) => `
                                <div class="option" onclick="selectOption(${index}, ${optIndex})" id="q${index}opt${optIndex}">
                                    <div class="option-letter">${String.fromCharCode(97 + optIndex)})</div>
                                    <div class="option-text">${option}</div>
                                </div>
                            `).join('')}
                        </div>`;
                    container.appendChild(div);
                });

                resetStateValues();
                updateUI();
                clearInterval(timerInterval);
                startTimer();

            } catch (err) {
                console.error(err);
                container.innerHTML = `<div class="question">‚ö†Ô∏è <strong>Error:</strong><br>${err.message}</div>`;
            }
        }

        function shuffleArray(array){ for (let i = array.length - 1; i > 0; i--){ const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
        function startTimer(){ timerInterval = setInterval(() => { time++; document.getElementById('timerValue').textContent = `${time}s`; }, 1000); }
        function selectOption(qIndex, oIndex){
            for (let i=0; i<questions[qIndex].options.length; i++) document.getElementById(`q${qIndex}opt${i}`).classList.remove('selected');
            document.getElementById(`q${qIndex}opt${oIndex}`).classList.add('selected');
            selectedAnswers[qIndex] = oIndex;
            updateProgress();
        }
        function updateProgress(){ completed = Object.keys(selectedAnswers).length; document.getElementById('progressFill').style.width = `${(completed / questions.length) * 100}%`; }
        function updateUI(){
            document.getElementById('healthBar').style.width = `${(monsterHP / maxHP) * 100}%`;
            document.getElementById('healthText').textContent = `${monsterHP} / ${maxHP} HP`;
            document.getElementById('attemptsValue').textContent = attempts;
            document.getElementById('errorsValue').textContent = `${errors} / ${maxErrors}`;
            const dots = document.querySelectorAll('.error-dot'); dots.forEach((d, i) => d.classList.toggle('filled', i < errors));
        }
        function attack(){
            if (gameOver) return;
            attempts++;
            let correct = true;
            Object.entries(selectedAnswers).forEach(([qIdx, ansIdx]) => {
                const q = questions[qIdx];
                const options = document.querySelectorAll(`#q${qIdx}opt${ansIdx}`);
                if (ansIdx == q.correct) options[0].classList.add('correct');
                else { options[0].classList.add('incorrect'); errors++; correct = false; }
            });
            if (correct) monsterHP--; else errors++;
            updateUI();
            if (monsterHP <= 0){ endGame('victory'); }
            else if (errors >= maxErrors){ endGame('defeat'); }
        }
        function resetStateValues(){ time = attempts = errors = completed = 0; monsterHP = maxHP; selectedAnswers = {}; }
        function resetBattle(){ resetStateValues(); updateUI(); document.getElementById('questionsContainer').innerHTML = ''; initGame(); document.getElementById('gameStatus').style.display = 'none'; }
        function endGame(status){
            gameOver = true; clearInterval(timerInterval);
            const statusDiv = document.getElementById('gameStatus'); statusDiv.style.display = 'block';
            if (status === 'victory') statusDiv.className = 'game-status victory', statusDiv.textContent = '¬°Victoria! Has derrotado al Maestro de los N√∫cleos.';
            else if (status === 'defeat') statusDiv.className = 'game-status defeat', statusDiv.textContent = '¬°Derrota! Intenta de nuevo.';
        }
        function showSolutions(){
            const container = document.getElementById('questionsContainer');
            questions.forEach((q, qIndex) => {
                q.options.forEach((opt, optIndex) => {
                    const optDiv = document.getElementById(`q${qIndex}opt${optIndex}`);
                    if (optIndex === q.correct) optDiv.classList.add('correct');
                });
            });
        }
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
